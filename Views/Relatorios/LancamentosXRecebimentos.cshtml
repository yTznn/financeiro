@model Financeiro.Models.ViewModels.RelatorioInstrumentoViewModel

@{
    Layout = null; // O conteúdo do PDF não deve ter o Layout principal da aplicação
    // Calcula a data de hoje para o rodapé do relatório
    var dataGeracao = DateTime.Now.ToString("dd/MM/yyyy HH:mm");
}

<!DOCTYPE html>
<html>
<head>
    <title>Relatório - @Model.InstrumentoNumero</title>
    <style>
        body { font-family: 'Arial', sans-serif; font-size: 10pt; margin: 0; padding: 0; }
        .header {
            width: 100%; 
            border-bottom: 3px solid #007bff; /* Azul primário */
            padding-bottom: 10px; 
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
        }
        .header h1 { font-size: 16pt; color: #333; margin: 0; }
        .header img { width: 100px; height: auto; }

        .info-box { 
            border: 1px solid #ccc; 
            padding: 10px; 
            margin-bottom: 15px; 
            border-radius: 5px;
            background-color: #f8f9fa;
        }
        .info-item { margin-bottom: 5px; font-size: 10pt; }
        .info-item strong { color: #555; display: inline-block; width: 150px; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #007bff; color: white; font-size: 10pt; }
        
        /* Regra CRÍTICA de coloração em vermelho */
        .alerta-recebimento td, .alerta-recebimento th { 
            background-color: #f8d7da !important; 
            color: #721c24 !important; 
            border-color: #f5c6cb;
        }

        .valor-saida { color: #dc3545; font-weight: bold; }
        .valor-entrada { color: #28a745; font-weight: bold; }
        .rodape { 
            margin-top: 30px; 
            font-size: 9pt; 
            border-top: 1px solid #ccc; 
            padding-top: 10px;
            display: flex;
            justify-content: space-between;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <h1>Relatório de Lançamentos X Recebimentos</h1>
            <div style="font-size: 12pt; color: #555;">Instrumento: @Model.InstrumentoNumero</div>
        </div>
        <img src="https://via.placeholder.com/100x40?text=IPGSE+LOGO" alt="Logo IPGSE" />
    </div>

    <div class="info-box">
        <div class="info-item"><strong>Instrumento:</strong> @Model.InstrumentoNumero</div>
        <div class="info-item"><strong>Período de Referência:</strong> @Model.ReferenciaPeriodo (@Model.DataInicioPeriodo.ToString("dd/MM/yyyy") a @Model.DataFimPeriodo.ToString("dd/MM/yyyy"))</div>
        <div class="info-item"><strong>Saldo Inicial no Mês:</strong> <span class="valor-entrada">@Model.SaldoInicialMes.ToString("C")</span></div>
        <div class="info-item"><strong>Possui Recebimento no Período:</strong> 
            @if (Model.PossuiRecebimento)
            {
                <span class="valor-entrada">SIM</span>
            }
            else
            {
                <span style="color:red; font-weight:bold;">NÃO ENCONTRADO (ALERTA!)</span>
            }
        </div>
    </div>
    
    <table class="@(!Model.PossuiRecebimento ? "alerta-recebimento" : "")">
        <thead>
            <tr>
                <th style="width: 10%;">#</th>
                <th style="width: 20%;">Data Lançamento</th>
                <th style="width: 30%; text-align: right;">Valor (Saída)</th>
                <th style="width: 40%; text-align: right;">Saldo Cumulativo</th>
            </tr>
        </thead>
        <tbody>
            @if (!Model.Lancamentos.Any())
            {
                <tr><td colspan="4" style="text-align: center;">Nenhum lançamento encontrado neste período.</td></tr>
            }
            else
            {
                @foreach (var lancamento in Model.Lancamentos)
                {
                    <tr>
                        <td>@lancamento.LancamentoSequencial</td>
                        <td>@lancamento.DataLancamento.ToString("dd/MM/yyyy HH:mm:ss")</td>
                        <td style="text-align: right;" class="valor-saida">@lancamento.ValorLancamento.ToString("C")</td>
                        <td style="text-align: right;">
                            @lancamento.SaldoCumulativo.ToString("C")
                        </td>
                    </tr>
                }
                
                <tr>
                    <td colspan="2" style="font-weight: bold; text-align: right; background-color: #eee;">TOTAL SAÍDAS:</td>
                    <td style="font-weight: bold; text-align: right;" class="valor-saida">@Model.ValorTotalSaidas.ToString("C")</td>
                    <td style="font-weight: bold; text-align: right; background-color: #eee;">SALDO FINAL:</td>
                </tr>
            }
        </tbody>
    </table>

    <div class="rodape">
        <span>Documento gerado em: @dataGeracao</span>
        <span>Página 1 de 1</span>
    </div>
</body>
</html>