@model Financeiro.Models.ViewModels.PessoaJuridicaViewModel
@{
    ViewBag.Title = Model.Id == 0 ? "Cadastrar nova pessoa jurídica" : "Editar pessoa jurídica";
    Layout = "_Layout";
}

<!-- FLAGS (para SweetAlert) -->
<div id="pageFlags"
     data-success="@TempData["Sucesso"]"
     data-error="@TempData["Erro"]"></div>

<div class="container-md mt-4" style="max-width: 700px;">
    <h2 class="mb-4 fw-bold">
        <i class="bi bi-person-vcard-fill me-2"></i>@ViewBag.Title
    </h2>

    <form asp-controller="PessoasJuridicas"
          asp-action="@(Model.Id == 0 ? "Salvar" : "Atualizar")"
          method="post"
          class="row g-3">

        @Html.AntiForgeryToken()
        <input asp-for="Id" type="hidden" />

        <div class="col-12">
            <label asp-for="RazaoSocial" class="form-label fw-semibold">
                <i class="bi bi-briefcase-fill me-1 text-secondary"></i> Razão Social
            </label>
            <input asp-for="RazaoSocial" class="form-control" placeholder="Nome do fornecedor" />
            <span asp-validation-for="RazaoSocial" class="text-danger small"></span>
        </div>

        <div class="col-12">
            <label asp-for="NomeFantasia" class="form-label fw-semibold">
                <i class="bi bi-shop-window me-1 text-secondary"></i> Nome Fantasia
            </label>
            <input asp-for="NomeFantasia" class="form-control" placeholder="Nome comercial / Fachada" />
            <span asp-validation-for="NomeFantasia" class="text-danger small"></span>
        </div>

        <div class="col-12">
            <label asp-for="NumeroInscricao" class="form-label fw-semibold">
                <i class="bi bi-file-earmark-text me-1 text-secondary"></i> CNPJ
            </label>
            <input asp-for="NumeroInscricao" class="form-control" placeholder="00.000.000/0000-00" />
            <span asp-validation-for="NumeroInscricao" class="text-danger small"></span>
        </div>

        <div class="col-12">
            <label asp-for="Email" class="form-label fw-semibold">
                <i class="bi bi-envelope-fill me-1 text-secondary"></i> E-mail
            </label>
            <input asp-for="Email" class="form-control" placeholder="exemplo@dominio.com" />
            <span asp-validation-for="Email" class="text-danger small"></span>
        </div>

        <div class="col-12">
            <label asp-for="Telefone" class="form-label fw-semibold">
                <i class="bi bi-telephone-fill me-1 text-secondary"></i> Telefone
            </label>
            <input asp-for="Telefone" class="form-control" placeholder="(xx) 9999-9999" />
            <span asp-validation-for="Telefone" class="text-danger small"></span>
        </div>

        <div class="col-12 d-flex align-items-center">
            <div class="form-check">
                <input asp-for="SituacaoAtiva" class="form-check-input" />
                <label asp-for="SituacaoAtiva" class="form-check-label fw-semibold">
                    <i class="bi bi-check-circle text-success me-1"></i> Ativo
                </label>
            </div>
        </div>

        <div class="col-12 mt-3">
            <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>
            <button type="submit" class="btn btn-success">
                <i class="bi bi-save2-fill me-1"></i>
                @(Model.Id == 0 ? "Salvar" : "Atualizar")
            </button>
            <a asp-action="Index" class="btn btn-secondary ms-2">
                <i class="bi bi-arrow-left-circle me-1"></i> Cancelar
            </a>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script src="~/lib/jquery-mask/jquery.mask.min.js"></script>

    <script>
        $(function () {

            // ========== Máscaras
            $('#NumeroInscricao').mask('00.000.000/0000-00');

            $('#Telefone').mask('(00) 0000-00009').on('keyup', function(){
                var val  = $(this).val().replace(/\D/g,'');
                var mask = (val.length > 10) ? '(00) 00000-0000' : '(00) 0000-00009';
                $(this).mask(mask);
            });

            // ========== SweetAlert com TempData ==========
            const flags = document.getElementById("pageFlags");
            if (flags) {
                const ok   = (flags.dataset.success || "").trim();
                const erro = (flags.dataset.error   || "").trim();
                if (ok)   Swal.fire({ text: ok,   icon: "success" });
                if (erro) Swal.fire({ text: erro, icon: "error"   });
            }
        });
    </script>
}